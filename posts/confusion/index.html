<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="next" href="https://hellosilicat.github.io/posts/2lr/" />
  <link rel="canonical" href="https://hellosilicat.github.io/posts/confusion/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Confusion Matrix and Measurement | Jialiang Pei
       
  </title>
  <meta name="title" content="Confusion Matrix and Measurement | Jialiang Pei">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/hellosilicat.github.io\/"
    },
    "articleSection" : "posts",
    "name" : "Confusion Matrix and Measurement",
    "headline" : "Confusion Matrix and Measurement",
    "description" : " 在有监督分类学习中，混淆矩阵(confusion matrix)可用来描述模型在数据集上的预测状况，如针对$k$分类问题，混淆矩阵$C$为$k$阶方阵，其中$C_{i,j}(i,j\\le k)$表示实际类别为$i$而模型预测类别为$j$的样本数；在混淆矩阵的基础上，我们可以定义各种度量用以评估模型性能，本文将介绍：准确率(accuracy)、精确率P(precision)、召回率R(recall)、F1值、P-R曲线与BEP(break-even point)、ROC曲线与AUC。\n以二分类问题为例，类别包含正类$P$、负类$N$，其混淆矩阵如下图所示。其中：\n $TP$：实际为正类且预测为正类的样本数 $FN$：实际为正类而预测为负类的样本数 $FP$：实际为负类而预测为正类的样本数 $TN$：实际为负类而预测为负类的样本数  准确率Accuracy指在所有样本中模型预测正确的比例，即：$$Accuracy=\\frac{TP\x2bTN}{TP\x2bFN\x2bFP\x2bTN}$$\n在类别不均衡问题中，准确率不能很好的度量性能，例如在99个正类和1个负类的数据集中，即使盲猜正类也能获得很高的准确率，然而这样的模型不具有泛化性，因此需要同时考虑精确率和召回率。\n精确率P指在预测为正类的样本中预测正确的比例，即：$$Precision=\\frac{TP}{TP\x2bFP}$$\n召回率R指在实际为正类的样本中预测正确的比例，即：$$Recall=\\frac{TP}{TP\x2bFN}$$\n如何理解精确率和召回率？西瓜书中有一个例子：你去买西瓜，精确率关注你挑的瓜中有多少比例是好瓜，而召回率更关注有多少比例的好瓜被你挑了出来。\n精确率与召回率是负相关的，精确率高时往往召回率会降低，反之亦然。如何综合两者去考量一个模型？P-R曲线与BEP便是方法之一。\nP-R曲线横轴是召回率，纵轴是精确率，BEP(break-even point)是指曲线上横纵坐标相等的点，可以认为是平衡点。\n如何绘制P-R曲线？对于一个样本集合，根据模型结果或中间值对样本进行排序，靠前的样本有更大概率被分为正类；之后逐个样本作为阈值，比该样本靠前的预测为正类，其余为负类，每次计算Precision和Recall，这样得到一系列二维点，绘制即可得到该曲线，通常情况下曲线为离散状，随数据集规模增加而更平滑。\n如下图，当模型A的P-R曲线包含模型B的P-R曲线时，可认为A的性能更佳，如Model2优于Model1，然而P-R曲线也会出现交叉，此时可根据模型的BEP来判断，如Model3的BEP大于Model2的BEP(处于右上方)，则认为Model3的性能优于Model2。\n通过P-R曲线来综合考虑精确率和召回率难免比较麻烦，另一个相对简单但有效的方式是计算F1值，F1值越大，模型性能越好。\nF1-Score是精确率P和召回率R的调和平均数，即：$$\\frac{1}{F1}=\\frac{1}{2}(\\frac{1}{P}\x2b\\frac{1}{R})$$\n当存在多个混淆矩阵(多次训练或多个数据集等产生)时，F1值可分为macro-F1和micro-F1，两者区别在于粒度不同。\nmacro-F1是指先计算出每个混淆矩阵的P和R，得到平均值后再计算F1值；\nmicro-F1是指先计算每个混淆矩阵的TP\/FN\/FP，得到平均值后计算P和R，最终再计算F1值；\n不同的业务场景对精确率和召回率的要求是不同的，例如推荐系统中更关注推荐的东西是用户喜欢的，即更关注精确率，此时可通过加权F1值来评估模型。\n加权F1-Score通过调整F1计算公式P、R系数来改变二者的重要程度，即：$$F_\\beta=\\frac{1}{1\x2b\\beta^2}(\\frac{1}{P}\x2b\\frac{\\beta^2}{R})$$\n当$\\beta=1$时退化成普通F1，当$\\beta\x26gt;1$时更关注召回率R，当$\\beta\x26lt;1$时更关注精确率P(可分别计算P、R的偏导系数，越大说明该因子影响越大)。\n与P-R曲线类似的是ROC(Receiver Operating Characteristic)曲线，也是先对样本进行排序，按此顺序逐片段作为正例进行预测，每次计算两个值，然后绘制曲线，不过ROC曲线的横轴是假阳率FPR(False Positive Rate)，纵轴为真阳率TPR(True Positive Rate)，其定义为： $$TPR=\\frac{TP}{TP\x2bFN}$$ $$FPR=\\frac{FP}{TN\x2bFP}$$\n现实任务中，ROC曲线是离散的，如下图，一种绘制方法为首先将样本按照预测结果或中间值进行排序，然后依次将每个样本划分为正例，设正样本个数为$m^\x2b$，负样本个数为$m-$，前一个标记点坐标为$(x,y)$，当前样本实际若为正例，则绘制$(x,y\x2b\\frac{1}{m^\x2b})$，当前样本实际若为负例，则绘制$(x\x2b\\frac{1}{m^-},y)$，以此类推，ROC曲线必经过$(0,0)$点和$(1,1)$点，分别对应全部预测负类和全部预测正类的情况。\n同样，当一个模型的ROC曲线包含包含另一个模型的ROC曲线时(所有点在左上方)，可认为该模型更优，然而面对ROC曲线的情况，需要引入AUC值来衡量模型好坏，AUC越大，说明模型性能更优。\nAUC(Area Under ROC Curve)指ROC曲线下方的面积，将$x_{i}$ 按照大小顺序排列，AUC计算公式为(其中$m$指样本集大小)：$$AUC=\\frac{1}{2}\\sum_{i=1}^{m-1}(x_{i\x2b1}-x_i)(y_i\x2by_{i\x2b1})$$\n参考资料：  《机器学习》，周志华，清华大学出版社，2017  ",
    "inLanguage" : "en",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2019",
    "datePublished": "2019-10-10 12:31:14 \x2b0800 CST",
    "dateModified" : "2019-10-10 12:31:14 \x2b0800 CST",
    "url" : "https:\/\/hellosilicat.github.io\/posts\/confusion\/",
    "wordCount" : "45",
    "keywords" : [  "Jialiang Pei"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hellosilicat.github.io/">Jialiang Pei</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/life/" title="">Life</a>
                
                <a class="menu-item" href="/" title="">Sci &amp; Tech</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://hellosilicat.github.io/">Jialiang Pei</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/about/" title="">About</a>
                
                <a class="menu-item" href="/life/" title="">Life</a>
                
                <a class="menu-item" href="/" title="">Sci &amp; Tech</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Confusion Matrix and Measurement</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://hellosilicat.github.io/" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2019-10-10 itemprop="datePublished">October 10, 2019</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          

<p>在有监督分类学习中，混淆矩阵(confusion matrix)可用来描述模型在数据集上的预测状况，如针对$k$分类问题，混淆矩阵$C$为$k$阶方阵，其中$C_{i,j}(i,j\le k)$表示实际类别为$i$而模型预测类别为$j$的样本数；在混淆矩阵的基础上，我们可以定义各种度量用以评估模型性能，本文将介绍：<strong>准确率</strong>(accuracy)、<strong>精确率</strong>P(precision)、<strong>召回率</strong>R(recall)、<strong>F1值</strong>、<strong>P-R曲线与BEP</strong>(break-even point)、<strong>ROC曲线与AUC</strong>。</p>

<p>以二分类问题为例，类别包含正类$P$、负类$N$，其混淆矩阵如下图所示。其中：</p>

<ul>
<li>$TP$：实际为正类且预测为正类的样本数</li>
<li>$FN$：实际为正类而预测为负类的样本数</li>
<li>$FP$：实际为负类而预测为正类的样本数</li>
<li>$TN$：实际为负类而预测为负类的样本数</li>
</ul>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="http://m.qpic.cn/psb?/V12HCzzo2MbQyJ/nx1iJNnRCVzYYh70pFM8zlBg4a4EfzzJ3KbdMhwcsYA!/b/dD4BAAAAAAAA&amp;bo=pAGdAKQBnQADCSw!&amp;rf=viewer_4" alt="confusion-2-class" class="lazyload"><figcaption class="image-caption">confusion-2-class</figcaption></figure></p>

<hr />

<p><strong>准确率Accuracy</strong>指在所有样本中模型预测正确的比例，即：$$Accuracy=\frac{TP+TN}{TP+FN+FP+TN}$$</p>

<hr />

<p>在类别不均衡问题中，准确率不能很好的度量性能，例如在99个正类和1个负类的数据集中，即使盲猜正类也能获得很高的准确率，然而这样的模型不具有泛化性，因此需要同时考虑精确率和召回率。</p>

<p><strong>精确率P</strong>指在<u>预测为正类的样本</u>中预测正确的比例，即：$$Precision=\frac{TP}{TP+FP}$$</p>

<p><strong>召回率R</strong>指在<u>实际为正类的样本</u>中预测正确的比例，即：$$Recall=\frac{TP}{TP+FN}$$</p>

<p>如何理解精确率和召回率？西瓜书中有一个例子：你去买西瓜，精确率关注你挑的瓜中有多少比例是好瓜，而召回率更关注有多少比例的好瓜被你挑了出来。</p>

<hr />

<p>精确率与召回率是负相关的，精确率高时往往召回率会降低，反之亦然。如何综合两者去考量一个模型？P-R曲线与BEP便是方法之一。</p>

<p><strong>P-R曲线</strong>横轴是召回率，纵轴是精确率，<strong>BEP</strong>(break-even point)是指曲线上横纵坐标相等的点，可以认为是平衡点。</p>

<p>如何绘制P-R曲线？对于一个样本集合，根据模型结果或中间值对样本进行排序，靠前的样本有更大概率被分为正类；之后逐个样本作为阈值，比该样本靠前的预测为正类，其余为负类，每次计算Precision和Recall，这样得到一系列二维点，绘制即可得到该曲线，通常情况下曲线为离散状，随数据集规模增加而更平滑。</p>

<p>如下图，当模型A的P-R曲线包含模型B的P-R曲线时，可认为A的性能更佳，如Model2优于Model1，然而P-R曲线也会出现交叉，此时可根据模型的BEP来判断，如Model3的BEP大于Model2的BEP(处于右上方)，则认为Model3的性能优于Model2。</p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="http://m.qpic.cn/psb?/V12HCzzo2MbQyJ/WbY0EFl9wDm1lwsjLSXL1iKXiPOZuWB0lGckxP5h*0k!/b/dLYAAAAAAAAA&amp;bo=pAETAQAAAAADB5U!&amp;rf=viewer_4" alt="PRCurve" class="lazyload"><figcaption class="image-caption">PRCurve</figcaption></figure></p>

<hr />

<p>通过P-R曲线来综合考虑精确率和召回率难免比较麻烦，另一个相对简单但有效的方式是计算F1值，F1值越大，模型性能越好。</p>

<p><strong>F1-Score</strong>是精确率P和召回率R的调和平均数，即：$$\frac{1}{F1}=\frac{1}{2}(\frac{1}{P}+\frac{1}{R})$$</p>

<p>当存在多个混淆矩阵(多次训练或多个数据集等产生)时，F1值可分为macro-F1和micro-F1，两者区别在于粒度不同。</p>

<p><strong>macro-F1</strong>是指先计算出每个混淆矩阵的P和R，得到平均值后再计算F1值；</p>

<p><strong>micro-F1</strong>是指先计算每个混淆矩阵的TP/FN/FP，得到平均值后计算P和R，最终再计算F1值；</p>

<p>不同的业务场景对精确率和召回率的要求是不同的，例如推荐系统中更关注推荐的东西是用户喜欢的，即更关注精确率，此时可通过加权F1值来评估模型。</p>

<p><strong>加权F1-Score</strong>通过调整F1计算公式P、R系数来改变二者的重要程度，即：$$F_\beta=\frac{1}{1+\beta^2}(\frac{1}{P}+\frac{\beta^2}{R})$$</p>

<p>当$\beta=1$时退化成普通F1，当$\beta&gt;1$时更关注召回率R，当$\beta&lt;1$时更关注精确率P(可分别计算P、R的偏导系数，越大说明该因子影响越大)。</p>

<hr />

<p>与P-R曲线类似的是ROC(Receiver Operating Characteristic)曲线，也是先对样本进行排序，按此顺序逐片段作为正例进行预测，每次计算两个值，然后绘制曲线，不过ROC曲线的横轴是<strong>假阳率FPR</strong>(False Positive Rate)，纵轴为<strong>真阳率TPR</strong>(True Positive Rate)，其定义为：
$$TPR=\frac{TP}{TP+FN}$$
$$FPR=\frac{FP}{TN+FP}$$</p>

<p>现实任务中，ROC曲线是离散的，如下图，一种绘制方法为首先将样本按照预测结果或中间值进行排序，然后<u>依次将每个样本划分为正例</u>，设正样本个数为$m^+$，负样本个数为$m-$，前一个标记点坐标为$(x,y)$，当前样本实际若为正例，则绘制$(x,y+\frac{1}{m^+})$，当前样本实际若为负例，则绘制$(x+\frac{1}{m^-},y)$，以此类推，ROC曲线必经过$(0,0)$点和$(1,1)$点，分别对应全部预测负类和全部预测正类的情况。</p>

<p><figure><img src="/images/ring.svg" data-sizes="auto" data-src="http://m.qpic.cn/phttp://m.qpic.cn/psb?/V12HCzzo2MbQyJ/AivCkOhAsUwnSqCSdz7q9GgOSdk2m*tfLAlDbsI7ueo!/b/dL4AAAAAAAAA&amp;bo=pAFiAQAAAAADB.Q!&amp;rf=viewer_4sb?/V12HCzzo2MbQyJ/RJlfBDDKwTgwQrD.7ALx9hkpcI4JHcg6ZVhshjOrivE!/b/dLYAAAAAAAAA&amp;bo=4AGVAQAAAAADB1c!&amp;rf=viewer_4" alt="ROcCurve" class="lazyload"><figcaption class="image-caption">ROcCurve</figcaption></figure></p>

<p>同样，当一个模型的ROC曲线包含包含另一个模型的ROC曲线时(所有点在左上方)，可认为该模型更优，然而面对ROC曲线的情况，需要引入AUC值来衡量模型好坏，AUC越大，说明模型性能更优。</p>

<p><strong>AUC</strong>(Area Under ROC Curve)指ROC曲线下方的面积，将$x_{i}$ 按照大小顺序排列，AUC计算公式为(其中$m$指样本集大小)：$$AUC=\frac{1}{2}\sum_{i=1}^{m-1}(x_{i+1}-x_i)(y_i+y_{i+1})$$</p>

<hr />

<h4 id="参考资料">参考资料：</h4>

<ol>
<li>《机器学习》，周志华，清华大学出版社，2017</li>
</ol>

    </div>

    <div class="post-copyright">
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://hellosilicat.github.io/posts/confusion/>https://hellosilicat.github.io/posts/confusion/</span>
            </p>
            
            
    </div>

  
    <div class="post-tags">
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://hellosilicat.github.io/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
         
        
        <a href="https://hellosilicat.github.io/posts/2lr/" class="next" rel="next" title="Linear Regression and Logistic Regression">Linear Regression and Logistic Regression&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
